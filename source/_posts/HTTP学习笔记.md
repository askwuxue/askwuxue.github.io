---
title: HTTP学习笔记
date: 2020-04-01 11:16:06
tags: HTTP
categories: HTTP
---

# HTTP学习笔记
_HTTP协议，只是网络协议中很小的一部分。HTTP协议对我们来说，看不见，摸不着，但是真实存在。或许我们无法像使用编程语言一样，实现具体的功能。但是HTTP的重要性，不需要特意强调。跨域方案`CROS`响应头信息字段`Access-Control-Allow-Origin`的设置，使用`cookie`时,响应头`Set-Cookie`的设置等等，其实我们都在使用HTTP协议。但是一般情况下都是边用边查，没有形成体系。没有一个组织结构，导致都是一些零散的知识点，对于使用，学习，存在很大的困难。这篇博客（可能不是一篇），有体系的整理HTTP协议的内容。希望可以帮助自己和其他小伙伴_

### 什么是HTTP协议
  HTTP（HyperText Transfer Protocol）超文本传输协议。
  1. 超文本：包括文字，图片，音频，视频等。
  2. 传输：负责超文本的传输
  3. 协议：负责传输超文本过程中的规范
#### 大白话总结
  HTTP就是一个用在计算机世界里面的协议，使用计算机能理解的语言，确立了计算机之间交流通信的规范。

### 发展历程
  _学习任何一项技术，都离不开发展历程。通过发展历程，才能知道这门技术在什么时候，遇到了什么样的问题，发生了什么变革。了解了这些，对我们的学习可以起到事半功倍的效果。_
下面按照HTTP的时间顺序整理
#### HTTP 0.9 
1. 只能处理纯文本格式
2. 请求响应结束后立即关闭连接
3. 只允许使用`GET`请求从服务器获取HTML文档
#### HTTP 1.1
1. 增加了HEAD，POST等新方法
2. 引入了HTTP Header的概念，处理请求和响应变得更加灵活
3. 传输数据不仅限于文本
4. 增加了响应状态码，标记可能的错误原因
5. 增加了PUT，DELETE等方法
6. 允许长连接
7. 增加了缓存管理和控制
8. 允许数据分块，利于传输大文件
9. 强制要求Host头
#### HTTP 2.0
1. 二进制协议，不仅限于纯文本。
2. 使用专用算法压缩头部，减少了数据传输量。
3. 废弃了管道，可以发起多个请求。
4. 增强了安全性，要求加密通信。
5. 允许服务端向客户端主动推送。


### 与HTTP相关的各种概念
1. CDN（Content Delivery Network）内容分发网络：应用于HTTP协议里的缓存和代理技术，代替源站响应客户端的请求。
2. 代理：HTTP协议中请求方和响应方直接的一个环节。代理分为下面几种。
- 匿名代理: 完全隐匿了被代理的机器，外界看到的只有代理服务器。
- 透明代理: 在传输过程中是“透明开放”的，外界即知道代理也知道客户端。
- 正向代理: 靠近客户端，代表客户端向服务端发送请求。
- 反向代理: 靠近服务端，代表服务端向客户端响应请求。


### TCP/IP协议族
  TCP/IP 协议严格来说并不是一种协议，而是互联网相关各类协议族的总称。其中包括TCP，IP，HTTP等协议。TCP/IP协议族最重要的一点就是分层。按照层次分为以下四层：应用层，传输层，网络层，数据链路层。
#### TCP/IP协议族各层的作用
  - 应用层: 决定向用户提供服务时通信的活动。如：FTP（文件传输协议），DNS（域名系统），HTTP协议
  - 传输层: 提供处于网络连接中的两台计算机之间的通信。如TCP（传输控制协议），UDP（用户数据报协议）
  - 网络层: 用来处理在网络上流动的数据包。数据包是网络传输的最小单位。该层规定了通过怎样的路径到达对象计算机，并把数据包传送给对方。在多台设备间传输时，网络层的作用就是选择一条传输路径。如:IP协议
  - 数据链路层: 用来处理连接网络的硬件部分。包括控制操作系统，硬件的设备驱动，网卡等一切传输介质。

### 与HTTP相关的各种协议
1. TCP 协议
    有状态的协议，需要先与对方建立连接然后才能发送数据，而且保证数据不丢失，不重复。TCP的数据是连续的字节流，有先后顺序。

2. UDP 协议
    无状态的协议，不用事先与对方建立连接就可以发送数据，但不保证数据一定会发送到对方。UDP的数据是分散的小数据包，顺序发，乱序收。
  
3. DNS协议
    DNS协议就是域名到IP的一个映射，将域名转成IP地址（一个IP地址可以对应多个域名）。域名方便我们记忆。但是网络中寻址，只认IP地址。所以需要将域名映射为IP。
DNS  通过一个访问顺序来逐渐确定域名的IP地址。
- 根域名服务器 > 顶级域名服务器 > 权威域名服务器。
  3.1 分析
    3.1.1 如果我们访问www.google.com 这个网址，假设没有缓存，是首次访问。

      1. 访问`root server `根服务器
        
      2. 根服务器返回了一个顶级域名的地址，即 .com 服务器地址
        
      3. 递归访问` .com`顶级域名服务器。
        
      4. 顶级域名服务器收到请求后，返回权威域名服务器地址，即`google.com`地址。

    3.1.2 如果我们第二次访问www.google.com 这个网址。

      5. 查看浏览器缓存，有没有DNS查询的结果
        
      6. 查看操作系统缓存，有没有DNS查询结果
        
      7. 查看主机映射文件`hosts`有没有`www.google.com`的IP映射
        
      8. 使用DNS协议。
  
  3.2 域名的新玩法
    1. 重定向
  
      - 将域名的IP在需要的时候进行更改，如切换主机。
    2. 实现负载均衡
  
      - 域名可以对应多个IP，即多台主机。客户端收到多个主机地址后，使用自己的轮询算法依次向服务器端发送请求，实现负载均衡。
      - 域名解析可以配置内部的策略，返回离客户端最近的主机，这样DNS端把请求分发到不同的服务器，实现负载均衡。



### HTTP请求过程
1. 浏览器从地址栏的输入中获得服务器的 IP 地址和端口号；
2. 浏览器用 TCP 的三次握手与服务器建立连接；
3. 浏览器向服务器发送拼好的报文；
4. 服务器收到报文后处理请求，同样拼好报文再发给浏览器；
5. 浏览器解析报文，渲染输出页面。

### HTTP请求总结
1. HTTP 协议基于底层的 TCP/IP 协议，所以必须要用 IP 地址建立连接；
2. 如果不知道 IP 地址，就要用 DNS 协议去解析得到 IP 地址，否则就会连接失败；
3. 建立 TCP 连接后会顺序收发数据，请求方和应答方都必须依据 HTTP 规构建和解析报文；
4. 为了减少响应时间，整个过程中的每一个环节都会有缓存，能够实现“短路”操作；